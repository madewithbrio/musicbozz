<html>
<head>
<title>WebSocket</title>

<style>
 html,body{font:normal 0.9em arial,helvetica;}
 #log {width:440px; height:200px; border:1px solid #7F9DB9; overflow:auto;}
 #msg {width:330px;}
</style>
<script src="http://autobahn.s3.amazonaws.com/js/autobahn.min.js"></script>
<script>
// WAMP session object
var sess;
var wsuri = "ws://localhost:9000";
 
window.onload = function() {
 
   // connect to WAMP server
   ab.connect(wsuri,
 
      // WAMP session was established
      function (session) {
 
         sess = session;
         console.log("Connected to " + wsuri);
 
         // subscribe to topic, providing an event handler
         sess.subscribe("http://localhost/game/2", onEvent);
      },
 
      // WAMP session is gone
      function (code, reason) {
 
         sess = null;
         console.log("Connection lost (" + reason + ")");
      }
   );
};
 
function onEvent(topic, event) {
   console.log(topic);
   console.log(event);
}
 
function publishEvent()
{
   sess.publish("http://localhost/game/2", {a: "foo", b: "bar", c: 23});
}
 
function callProcedure() {
   // issue an RPC, returns promise object
   sess.call("http://localhost/game/2/process#test", 23, 7).then(
 
      // RPC success callback
      function (res) {
         console.log("got result: " + res);
      },
 
      // RPC error callback
      function (error, desc) {
         console.log("error: " + desc);
      }
   );
}
</script>
</head>
<body>
  <h1>Game Room #2</h1>
  <button onclick="publishEvent();">Publish Event</button>
  <button onclick="callProcedure();">Call Procedure</button>
</body>
</html>